---

layout:     post
title:      "服务器安装jekyll，搭建自己的博客"
subtitle:   ""
date:       2020-03-01
author:     "hcy"
header-img: "img/gene-head-img.jpg"
tags:
- jekyll
typora-root-url: ..
---









​	

​	本来图方便使用`gitpage`做静态博客，但国内访问速度太慢，并且因为自己也有服务器，打算移动到自己服务器上，然后定时从`github`上同步代码，自己写博客仍然直接push到`github`，使用方式不变。

​	并且这样也可以在`DNS`上将国内解析到服务器，国外解析到`gitpage`，这样一方面节省流量，一方面国内国外速度都能得到保障。下面讲具体步骤。



## 1 安装ruby

- 更新apt索引

```shell
apt -get update
```



- 安装ruby-full

```shell
apt-get install ruby-full
```



## 2 安装jekyll

[官网安装教程在这里](http://jekyllcn.com/docs/installation/)

- 不看官方教程，其实就是一个命令即可安装

```shell
gem install jekyll
```



## 3 安装 jekyll-paginate

- 这是`jekyll`的插件，没他可能编译会报错

```shell
gem install jekyll-paginate
```



## 4 尝试编译代码

从本地将代码用ftp上传到服务器上，使用如下命令,查看能否编译成功，是否报错：

```shell
jekyll build
```



## 5 创建自动化脚本

如果上面编译能成功，我们只需要将编译好的页面文件夹拷贝出来，并在nginx下做好配置。

一个自动脚本需要完成下面几个步骤

1. 从`github`上下载代码,未编译状态
2. 解压压缩包
3. 编译代码
4. 移动编译好的页面到nginx的指定文件夹下
5. 删除所有的临时文件



```shell
#!/bin/bash

#清理上次编译的资源
`rm -r /tmp/gitpagetemp*`

#创建临时文件夹
tempdir=`mktemp -t -d gitpagetemp.XXXXXX`


echo 创建临时文件夹成功：$tempdir


#从github下载master压缩包
`wget -P $tempdir https://codeload.github.com/switchYello/switchYello.github.io/zip/master`

#判断文件是否下载成功
if [ -n "$tempdir/master" ]; then
        echo 下载文件成功
else
        echo 下载文件失败
        exit
fi


#将文件解压到临时目录下 -o = overwrite
unziplog=` unzip -o $tempdir/master -d $tempdir/ `


if [ 0 -eq $? ];then
        echo 解压完成
else
        echo 解压失败
        echo $unziplog
        exit
fi


#编译，我的gitpage压缩包是switchYellow.gitpage.io，这里用通配符，--trace 表示输出日志，报错时能看到日志
jekyllbuildlog=`jekyll build --source $tempdir/switch* --destination $tempdir/_site/ --trace `


if [ 0 -eq $? ];then
         echo jekyll编译完成
else
        echo jekyll编译失败
        echo $jekyllbuildlog
        exit
fi


#移动。我要移动到/home/dwzs文件夹下，这里先判断文件夹是否存在
if [ -d /home/dwzs ];then
        echo "/home/dwzs文件夹已经存在，将覆盖里面的文件"
else
        mkdir /home/dwzs/
fi

# 移动到nginx监听的目录，-r 递归复制 -f 强制复制
` \cp -r -f  $tempdir/_site/*  /home/dwzs/ `


#移动完成

```





## 6 安装nginx

[可以参考这个安装教程](http://blog.dwzs.fun/2019/06/02/ubuntu-18-%E5%AE%89%E8%A3%85nginx/)

将放置编译好的页面文件夹配置到nginx下即可，我的是放在`/home/dwzs`下的。



## 7.创建定时任务

​	使用linux的定时任务，可以每天执行一两次脚本。

也可以使用github的push回掉钩子，但是我不需要更新的特别及时，保证一天时间能更新就行，这里就不做这个了。



